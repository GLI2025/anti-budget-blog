---
import Layout from "@/layouts/Layout.astro";
import Main from "@/layouts/Main.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { DEFAULT_LOCALE, SUPPORTED_LOCALES } from "@/i18n/config";
import { translateFor } from "@/i18n/utils";
import type { InferGetStaticParamsType } from "astro";

export async function getStaticPaths() {
  return SUPPORTED_LOCALES.map(locale => ({
    params: { locale },
    props: { locale },
  }));
}

type Props = InferGetStaticParamsType<typeof getStaticPaths>;
const { locale = DEFAULT_LOCALE } = Astro.props;

const t = translateFor(locale);

const defaults = {
  purchasePrice: 1_200_000,

  charterRatePerWeek: 25_000,
  charterWeeksPerYear: 4,

  ownerCharterRatePerWeek: 22_000,
  ownerCharterWeeksPerYear: 8,

  personalUseWeeks: 3,

  operatingCostRate: 0.10,
  resalePctAfter5y: 0.65,

  taxRate: 0.37,
  opportunityReturn: 0.09,

  startYear: 2026,
  horizonYears: 5,
};
---

<Layout title={`Buy vs Charter Catamaran (5-Year Net Worth) | ${t("site.title")}`}>
  <Header />

  <Main>
    <article class="mx-auto max-w-5xl">
      <header class="mb-8">
        <h1 class="text-3xl font-bold tracking-tight">Buy vs Charter a $1.2M Catamaran</h1>
        <p class="mt-3 text-base opacity-80">
          Compare the <strong>5-year net worth impact</strong> of buying a catamaran vs chartering it.
          Assumes <strong>100% bonus depreciation (2026)</strong> (when eligible), a <strong>37% tax bracket</strong>,
          <strong>10% annual operating costs</strong>, and a <strong>9% opportunity cost</strong> for unspent capital.
        </p>
        <p class="mt-3 text-sm opacity-80">
          <strong>Sailing hook:</strong> If personal use is <strong>more than 14 days</strong> (i.e., &gt; 2 weeks),
          the simplified tax treatment flips to <strong>Second Home / Residence</strong> (no bonus depreciation).
        </p>
      </header>

      <section class="mt-6 rounded-2xl border border-black/10 bg-white/70 p-5 dark:bg-black/20 ...">

        <div class="grid gap-6 md:grid-cols-2">

          <div>
            <label class="text-sm font-medium">Personal Use Weeks (per year)</label>
            <input id="personalUseWeeks" class="mt-2 w-full max-w-[420px] rounded-xl border border-black/10 p-3 dark:border-white/10"
              type="number" step="0.5" value={defaults.personalUseWeeks} />
          </div>

          <div>
            <label class="text-sm font-medium">Charter Weeks (your personal trips, per year)</label>
            <input id="charterWeeksPerYear" class="mt-2 w-full max-w-[420px] rounded-xl border border-black/10 p-3 dark:border-white/10"
              type="number" step="0.5" value={defaults.charterWeeksPerYear} />
          </div>

          <div>
            <label class="text-sm font-medium">Charter Rate (you pay) per week</label>
            <input id="charterRatePerWeek" class="mt-2 w-full max-w-[420px] rounded-xl border border-black/10 p-3 dark:border-white/10"
              type="number" step="1000" value={defaults.charterRatePerWeek} />
          </div>

          <div>
            <label class="text-sm font-medium">Owner Charter-Out Weeks (rent it out) per year</label>
            <input id="ownerCharterWeeksPerYear" class="mt-2 w-full max-w-[420px] rounded-xl border border-black/10 p-3 dark:border-white/10"
              type="number" step="0.5" value={defaults.ownerCharterWeeksPerYear} />
          </div>

          <div>
            <label class="text-sm font-medium">Owner Charter-Out Rate per week (gross)</label>
            <input id="ownerCharterRatePerWeek" class="mt-2 w-full max-w-[420px] rounded-xl border border-black/10 p-3 dark:border-white/10"
              type="number" step="1000" value={defaults.ownerCharterRatePerWeek} />
          </div>

          <div>
            <label class="text-sm font-medium">Resale Value after 5 years (% of purchase)</label>
            <input id="resalePctAfter5y" class="mt-2 w-full max-w-[420px] rounded-xl border border-black/10 p-3 dark:border-white/10"
              type="number" step="0.01" value={defaults.resalePctAfter5y} />
          </div>
        </div>

        <div class="mt-4 flex flex-wrap items-center justify-between gap-3">
          <div id="taxBanner" class="text-sm opacity-80"></div>
          <button id="recalcBtn" class="rounded-xl bg-black px-4 py-2 text-sm font-semibold text-white hover:opacity-90"
            type="button">
            Recalculate
          </button>
        </div>
      </section>

      <section class="mt-6 rounded-2xl border border-black/10 bg-white/50 p-5 dark:border-white/10 dark:bg-white/5">
  <h2 class="text-xl font-semibold">Results</h2>

  <!-- sanity-check highlights -->
  <div class="mt-3 grid gap-3 md:grid-cols-3">
    <div class="rounded-xl border border-black/10 bg-white/70 p-3 text-sm dark:border-white/10 dark:bg-black/20">
      <div class="opacity-70">Tax mode</div>
      <div id="modeValue" class="font-semibold"></div>
    </div>
    <div class="rounded-xl border border-black/10 bg-white/70 p-3 text-sm dark:border-white/10 dark:bg-black/20">
      <div class="opacity-70">5Y Charter Net Worth</div>
      <div id="charter5y" class="font-semibold"></div>
    </div>
    <div class="rounded-xl border border-black/10 bg-white/70 p-3 text-sm dark:border-white/10 dark:bg-black/20">
      <div class="opacity-70">5Y Buy Net Worth</div>
      <div id="buy5y" class="font-semibold"></div>
    </div>
  </div>

  <div id="taxBanner" class="mt-3 text-sm opacity-80"></div>

  <!-- table wrapper -->
  <div class="mt-4 overflow-x-auto rounded-xl border border-black/10 dark:border-white/10">
    <table class="min-w-[1100px] w-full border-collapse text-sm">
      <thead class="bg-black/5 dark:bg-white/10">
        <tr>
          <th class="p-3 text-left font-semibold">Year</th>
          <th class="p-3 text-right font-semibold">Tax Treatment</th>
          <th class="p-3 text-right font-semibold">Personal Use (wks)</th>
          <th class="p-3 text-right font-semibold">Charter Net Worth</th>
          <th class="p-3 text-right font-semibold">Buy Net Worth</th>
          <th class="p-3 text-right font-semibold">Delta (Buy - Charter)</th>
          <th class="p-3 text-right font-semibold">Owner Rental Income</th>
          <th class="p-3 text-right font-semibold">Owner Op Cost</th>
          <th class="p-3 text-right font-semibold">Allowed Deductions</th>
          <th class="p-3 text-right font-semibold">Taxable Income From Rent</th>
        </tr>
      </thead>

      <!-- IMPORTANT: explicit row styling so it doesn't disappear in theme styles -->
      <tbody id="resultsBody" class="bg-white/80 text-black dark:bg-black/20 dark:text-white"></tbody>
    </table>
  </div>

  <p class="mt-4 text-xs opacity-70">
    Assumptions (simplified): no depreciation recapture, no financing, no sale taxes, straight-line market value path,
    and a simplified vacation-home limitation when personal use &gt; 14 days. Educational only, not tax advice.
  </p>
</section>

    </article>

    <script type="module">
  import { runBuyVsCharter } from "../../utils/boatCalc";
console.log("boat-vs-charter script loaded");


  const $ = (id) => document.getElementById(id);

  const fmtMoney0 = new Intl.NumberFormat(undefined, {
    style: "currency",
    currency: "USD",
    maximumFractionDigits: 0,
  });

  const fmtNum = new Intl.NumberFormat(undefined, { maximumFractionDigits: 2 });

  const money = (x) => (typeof x === "number" ? fmtMoney0.format(x) : "");
  const num = (x) => (typeof x === "number" ? fmtNum.format(x) : "");

  const readNumber = (id) => {
    const el = $(id);
    const v = Number(el?.value ?? 0);
    return Number.isFinite(v) ? v : 0;
  };

  function render(rows) {
  const body = $("resultsBody");
  if (!body) return;

  const mode = rows?.[0]?.taxTreatment ?? "";
  const summary = rows.find((x) => x.year === "5Y Summary") ?? rows[rows.length - 1];

  // Helpers for consistent cell styling (works with your Tailwind theme)
  const trBase =
    "text-black dark:text-white border-b border-black/10 dark:border-white/10";
  const tdLeft = "p-3 text-left whitespace-nowrap";
  const tdRight = "p-3 text-right whitespace-nowrap tabular-nums";
  const tdRightWide = "p-3 text-right whitespace-nowrap tabular-nums min-w-[140px]";

  body.innerHTML = rows
    .map((r, idx) => {
      const isSummary = r.year === "5Y Summary";

      // Zebra + summary highlight (keeps it readable)
      const zebraClass = idx % 2 === 0 ? "bg-black/0 dark:bg-white/0" : "bg-black/5 dark:bg-white/5";
      const summaryClass = isSummary ? "bg-emerald-500/10 dark:bg-emerald-400/10 font-semibold" : "";

      return `
        <tr class="${trBase} ${zebraClass} ${summaryClass}">
          <td class="${tdLeft}">${r.year}</td>
          <td class="${tdRight}">${r.taxTreatment}</td>
          <td class="${tdRight}">${num(r.personalUseWeeks)}</td>

          <td class="${tdRightWide}">${money(r.charterNetWorth)}</td>
          <td class="${tdRightWide}">${money(r.buyNetWorth)}</td>
          <td class="${tdRightWide}">${money(r.deltaBuyMinusCharter)}</td>

          <td class="${tdRightWide}">${money(r.ownerRentalIncome)}</td>
          <td class="${tdRightWide}">${money(r.ownerOpCost)}</td>

          <td class="${tdRightWide}">${r.allowedDeductions === "" ? "" : money(r.allowedDeductions)}</td>
          <td class="${tdRightWide}">${r.taxableIncomeFromRent === "" ? "" : money(r.taxableIncomeFromRent)}</td>
        </tr>
      `;
    })
    .join("");

  // Fill the summary boxes
  const modeValue = $("modeValue");
  const charter5y = $("charter5y");
  const buy5y = $("buy5y");

  if (modeValue) modeValue.textContent = mode;
  if (charter5y) charter5y.textContent = money(summary.charterNetWorth);
  if (buy5y) buy5y.textContent = money(summary.buyNetWorth);

  // Put the message in the Results banner
  const bannerText =
    mode === "SecondHome/Residence"
      ? "Tax mode: Second Home / Residence (personal use > 14 days). Bonus

  function recalc() {
    const inputs = {
      purchasePrice: 1200000,

      charterRatePerWeek: readNumber("charterRatePerWeek"),
      charterWeeksPerYear: readNumber("charterWeeksPerYear"),

      ownerCharterRatePerWeek: readNumber("ownerCharterRatePerWeek"),
      ownerCharterWeeksPerYear: readNumber("ownerCharterWeeksPerYear"),

      personalUseWeeks: readNumber("personalUseWeeks"),

      operatingCostRate: 0.10,
      resalePctAfter5y: readNumber("resalePctAfter5y"),

      taxRate: 0.37,
      opportunityReturn: 0.09,

      startYear: 2026,
      horizonYears: 5,
    };

    const rows = runBuyVsCharter(inputs);
    render(rows);
  }

  $("recalcBtn").addEventListener("click", recalc);
  recalc();
</script>

  </Main>

  <Footer />
</Layout>
